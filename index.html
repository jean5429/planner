<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Weekly Agenda</title>
  <style>
    /* Design System Variables */
    :root {
  /* Primitive Color Tokens */
  --color-white: rgba(255, 255, 255, 1);
  --color-black: rgba(0, 0, 0, 1);
  --color-cream-50: rgba(252, 252, 249, 1);
  --color-cream-100: rgba(255, 255, 253, 1);
  --color-gray-200: rgba(245, 245, 245, 1);
  --color-gray-300: rgba(167, 169, 169, 1);
  --color-gray-400: rgba(119, 124, 124, 1);
  --color-slate-500: rgba(98, 108, 113, 1);
  --color-brown-600: rgba(94, 82, 64, 1);
  --color-charcoal-700: rgba(31, 33, 33, 1);
  --color-charcoal-800: rgba(38, 40, 40, 1);
  --color-slate-900: rgba(19, 52, 59, 1);
  --color-teal-300: rgba(50, 184, 198, 1);
  --color-teal-400: rgba(45, 166, 178, 1);
  --color-teal-500: rgba(33, 128, 141, 1);
  --color-teal-600: rgba(29, 116, 128, 1);
  --color-teal-700: rgba(26, 104, 115, 1);
  --color-teal-800: rgba(41, 150, 161, 1);
  --color-red-400: rgba(255, 84, 89, 1);
  --color-red-500: rgba(192, 21, 47, 1);
  --color-orange-400: rgba(230, 129, 97, 1);
  --color-orange-500: rgba(168, 75, 47, 1);

  /* RGB versions for opacity control */
  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;
  --color-slate-500-rgb: 98, 108, 113;
  --color-red-500-rgb: 192, 21, 47;
  --color-red-400-rgb: 255, 84, 89;
  --color-orange-500-rgb: 168, 75, 47;
  --color-orange-400-rgb: 230, 129, 97;

  /* Background color tokens (Light Mode) */
  --color-bg-1: rgba(59, 130, 246, 0.08);
  --color-bg-2: rgba(245, 158, 11, 0.08);
  --color-bg-3: rgba(34, 197, 94, 0.08);
  --color-bg-4: rgba(239, 68, 68, 0.08);
  --color-bg-5: rgba(147, 51, 234, 0.08);
  --color-bg-6: rgba(249, 115, 22, 0.08);
  --color-bg-7: rgba(236, 72, 153, 0.08);
  --color-bg-8: rgba(6, 182, 212, 0.08);

  /* Semantic Color Tokens (Light Mode) */
  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-btn-primary-text: var(--color-cream-50);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
  --color-error: var(--color-red-500);
  --color-success: var(--color-teal-500);
  --color-warning: var(--color-orange-500);
  --color-info: var(--color-slate-500);
  --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
  --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);

  /* Typography */
  --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system,
    BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-family-mono: "Berkeley Mono", ui-monospace, SFMono-Regular, Menlo,
    Monaco, Consolas, monospace;
  --font-size-xs: 11px;
  --font-size-sm: 12px;
  --font-size-base: 14px;
  --font-size-md: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  --font-size-2xl: 20px;
  --font-size-3xl: 24px;
  --font-size-4xl: 30px;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 550;
  --font-weight-bold: 600;
  --line-height-tight: 1.2;
  --line-height-normal: 1.5;
  --letter-spacing-tight: -0.01em;

  /* Spacing */
  --space-0: 0;
  --space-1: 1px;
  --space-2: 2px;
  --space-4: 4px;
  --space-6: 6px;
  --space-8: 8px;
  --space-10: 10px;
  --space-12: 12px;
  --space-16: 16px;
  --space-20: 20px;
  --space-24: 24px;
  --space-32: 32px;

  /* Border Radius */
  --radius-sm: 6px;
  --radius-base: 8px;
  --radius-md: 10px;
  --radius-lg: 12px;
  --radius-full: 9999px;

  /* Shadows */
  --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04),
    0 2px 4px -1px rgba(0, 0, 0, 0.02);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04),
    0 4px 6px -2px rgba(0, 0, 0, 0.02);
  --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.15),
    inset 0 -1px 0 rgba(0, 0, 0, 0.03);

  /* Animation */
  --duration-fast: 150ms;
  --duration-normal: 250ms;
  --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);

  /* Custom App Colors */
  --color-current-time: rgba(245, 158, 11, 0.15);
  --color-current-time-border: rgba(245, 158, 11, 0.4);
  --color-past-slot: rgba(var(--color-slate-500-rgb), 0.03);
  --color-notebook-line: rgba(var(--color-brown-600-rgb), 0.15);
}

/* Dark mode colors */
@media (prefers-color-scheme: dark) {
  :root {
    --color-gray-400-rgb: 119, 124, 124;
    --color-teal-300-rgb: 50, 184, 198;
    --color-gray-300-rgb: 167, 169, 169;
    --color-gray-200-rgb: 245, 245, 245;

    --color-bg-1: rgba(29, 78, 216, 0.15);
    --color-bg-2: rgba(180, 83, 9, 0.15);
    --color-bg-3: rgba(21, 128, 61, 0.15);
    --color-bg-4: rgba(185, 28, 28, 0.15);
    --color-bg-5: rgba(107, 33, 168, 0.15);
    --color-bg-6: rgba(194, 65, 12, 0.15);
    --color-bg-7: rgba(190, 24, 93, 0.15);
    --color-bg-8: rgba(8, 145, 178, 0.15);

    --color-background: var(--color-charcoal-700);
    --color-surface: var(--color-charcoal-800);
    --color-text: var(--color-gray-200);
    --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
    --color-primary: var(--color-teal-300);
    --color-primary-hover: var(--color-teal-400);
    --color-primary-active: var(--color-teal-800);
    --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
    --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
    --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
    --color-border: rgba(var(--color-gray-400-rgb), 0.3);
    --color-error: var(--color-red-400);
    --color-success: var(--color-teal-300);
    --color-warning: var(--color-orange-400);
    --color-info: var(--color-gray-300);
    --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
    --color-btn-primary-text: var(--color-slate-900);
    --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
    --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
    --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1),
      inset 0 -1px 0 rgba(0, 0, 0, 0.15);
    --color-select-caret: rgba(var(--color-gray-200-rgb), 0.8);
    
    --color-current-time: rgba(180, 83, 9, 0.2);
    --color-current-time-border: rgba(245, 158, 11, 0.5);
    --color-past-slot: rgba(var(--color-gray-400-rgb), 0.05);
    --color-notebook-line: rgba(var(--color-gray-400-rgb), 0.2);
  }
}

@font-face {
  font-family: 'FKGroteskNeue';
  src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2')
    format('woff2');
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  font-size: var(--font-size-base);
  font-family: var(--font-family-base);
  line-height: var(--line-height-normal);
  color: var(--color-text);
  background-color: var(--color-background);
  -webkit-font-smoothing: antialiased;
}

body {
  margin: 0;
  padding: 0;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

/* Header Styles */
.app-header {
  background-color: var(--color-surface);
  border-bottom: 1px solid var(--color-card-border);
  padding: var(--space-16) var(--space-20);
  box-shadow: var(--shadow-sm);
  position: sticky;
  top: 0;
  z-index: 100;
}

.header-content {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: var(--space-16);
  flex-wrap: wrap;
}

.header-left {
  display: flex;
  flex-direction: column;
  gap: var(--space-4);
}

.app-title {
  font-size: var(--font-size-2xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-text);
  letter-spacing: var(--letter-spacing-tight);
}

.current-datetime {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  font-weight: var(--font-weight-medium);
}

.header-actions {
  display: flex;
  gap: var(--space-8);
  align-items: center;
}

.btn-today,
.btn-settings {
  padding: var(--space-8) var(--space-16);
  border-radius: var(--radius-base);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-standard);
  border: none;
  display: inline-flex;
  align-items: center;
  gap: var(--space-6);
}

.btn-today {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
}

.btn-today:hover {
  background: var(--color-primary-hover);
}

.btn-settings {
  background: var(--color-secondary);
  color: var(--color-text);
}

.btn-settings:hover {
  background: var(--color-secondary-hover);
}

/* Day Tabs */
.day-tabs {
  background-color: var(--color-surface);
  border-bottom: 1px solid var(--color-card-border);
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

.day-tabs-container {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  gap: var(--space-4);
  padding: var(--space-12) var(--space-20);
}

.day-tab {
  padding: var(--space-10) var(--space-20);
  border-radius: var(--radius-base);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-standard);
  border: 1px solid var(--color-card-border);
  background: var(--color-background);
  color: var(--color-text-secondary);
  white-space: nowrap;
  flex-shrink: 0;
}

.day-tab:hover {
  background: var(--color-secondary);
  color: var(--color-text);
}

.day-tab.active {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
  border-color: var(--color-primary);
}

/* Main Content */
.main-content {
  flex: 1;
  max-width: 1200px;
  margin: 0 auto;
  width: 100%;
  padding: var(--space-24) var(--space-20);
}

.schedule-container {
  background-color: var(--color-surface);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-md);
  border: 1px solid var(--color-card-border);
  overflow: hidden;
}

.schedule-header {
  padding: var(--space-16) var(--space-20);
  border-bottom: 1px solid var(--color-card-border-inner);
  background: var(--color-bg-1);
}

.schedule-day-name {
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
}

.schedule-grid {
  padding: var(--space-20);
}

/* Time Slot Styles */
.time-slot {
  display: flex;
  align-items: stretch;
  border-bottom: 1px solid var(--color-notebook-line);
  min-height: 48px;
  transition: background-color var(--duration-fast) var(--ease-standard);
}

.time-slot:last-child {
  border-bottom: none;
}

.time-slot.current-time {
  background-color: var(--color-current-time);
  border-left: 3px solid var(--color-current-time-border);
  border-right: 3px solid var(--color-current-time-border);
}

.time-slot.past-slot {
  background-color: var(--color-past-slot);
}

.time-label {
  width: 80px;
  flex-shrink: 0;
  padding: var(--space-12) var(--space-12);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  font-weight: var(--font-weight-medium);
  display: flex;
  align-items: center;
  border-right: 1px solid var(--color-card-border-inner);
}

.slot-content {
  flex: 1;
  display: flex;
  align-items: center;
  gap: var(--space-12);
  padding: var(--space-8) var(--space-16);
  position: relative;
}

.unmerge-btn {
  padding: var(--space-4) var(--space-10);
  border-radius: var(--radius-sm);
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-standard);
  border: 1px solid var(--color-border);
  background: var(--color-secondary);
  color: var(--color-text-secondary);
  flex-shrink: 0;
  margin-left: auto;
  z-index: 100;
  position: relative;
  pointer-events: auto;
}

.unmerge-btn:hover {
  background: var(--color-secondary-hover);
  color: var(--color-text);
  border-color: var(--color-primary);
}

.slot-checkbox {
  width: 20px;
  height: 20px;
  cursor: pointer;
  flex-shrink: 0;
  accent-color: var(--color-primary);
}

.slot-checkbox:disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

.slot-input {
  flex: 1;
  border: none;
  background: transparent;
  font-size: var(--font-size-base);
  color: var(--color-text);
  font-family: var(--font-family-base);
  padding: var(--space-6);
  outline: none;
}

.slot-input:focus {
  background: var(--color-secondary);
  border-radius: var(--radius-sm);
}

.slot-input.checked {
  text-decoration: line-through;
  opacity: 0.6;
}

/* Language Selector */
.language-selector {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--space-8);
}

.language-option {
  display: flex;
  align-items: center;
  gap: var(--space-8);
  padding: var(--space-12) var(--space-16);
  border: 2px solid var(--color-border);
  border-radius: var(--radius-base);
  background: var(--color-background);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-standard);
  font-size: var(--font-size-base);
  color: var(--color-text);
}

.language-option:hover {
  background: var(--color-secondary);
  border-color: var(--color-primary);
}

.language-option.active {
  background: var(--color-primary);
  border-color: var(--color-primary);
  color: var(--color-btn-primary-text);
  font-weight: var(--font-weight-semibold);
}

.language-flag {
  font-size: var(--font-size-2xl);
  line-height: 1;
}

.language-name {
  flex: 1;
}

/* Modal Styles */
.modal-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  align-items: center;
  justify-content: center;
  padding: var(--space-20);
}

.modal-overlay.active {
  display: flex;
}

.modal {
  background-color: var(--color-surface);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  max-width: 500px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  border: 1px solid var(--color-card-border);
}

.modal-header {
  padding: var(--space-20) var(--space-24);
  border-bottom: 1px solid var(--color-card-border-inner);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-title {
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
}

.modal-close {
  background: none;
  border: none;
  font-size: var(--font-size-2xl);
  cursor: pointer;
  color: var(--color-text-secondary);
  padding: var(--space-4);
  line-height: 1;
  transition: color var(--duration-fast) var(--ease-standard);
}

.modal-close:hover {
  color: var(--color-text);
}

.modal-body {
  padding: var(--space-24);
}

.form-group {
  margin-bottom: var(--space-20);
}

.form-label {
  display: block;
  margin-bottom: var(--space-8);
  font-weight: var(--font-weight-medium);
  font-size: var(--font-size-sm);
  color: var(--color-text);
}

.form-select {
  width: 100%;
  padding: var(--space-10) var(--space-12);
  font-size: var(--font-size-base);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  background-color: var(--color-background);
  color: var(--color-text);
  cursor: pointer;
  transition: border-color var(--duration-fast) var(--ease-standard);
}

.form-select:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px var(--color-focus-ring);
}

.time-range-preview {
  margin-top: var(--space-12);
  padding: var(--space-12);
  background: var(--color-bg-1);
  border-radius: var(--radius-base);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

.modal-footer {
  padding: var(--space-20) var(--space-24);
  border-top: 1px solid var(--color-card-border-inner);
  display: flex;
  gap: var(--space-12);
  justify-content: flex-end;
}

.btn {
  padding: var(--space-10) var(--space-20);
  border-radius: var(--radius-base);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-standard);
  border: none;
}

.btn-primary {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
}

.btn-primary:hover {
  background: var(--color-primary-hover);
}

.btn-secondary {
  background: var(--color-secondary);
  color: var(--color-text);
}

.btn-secondary:hover {
  background: var(--color-secondary-hover);
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: var(--space-32);
  color: var(--color-text-secondary);
}

.empty-state-icon {
  font-size: 48px;
  margin-bottom: var(--space-16);
  opacity: 0.5;
}

.empty-state-text {
  font-size: var(--font-size-base);
}

/* Mobile Responsive */
@media (max-width: 768px) {
  .app-header {
    padding: var(--space-12) var(--space-16);
  }

  .header-content {
    flex-direction: column;
    align-items: flex-start;
  }

  .header-actions {
    width: 100%;
    justify-content: space-between;
  }

  .app-title {
    font-size: var(--font-size-xl);
  }

  .day-tabs-container {
    padding: var(--space-8) var(--space-16);
  }

  .day-tab {
    padding: var(--space-8) var(--space-12);
    font-size: var(--font-size-sm);
  }

  .main-content {
    padding: var(--space-16);
  }

  .time-label {
    width: 60px;
    font-size: var(--font-size-xs);
    padding: var(--space-8);
  }

  .slot-content {
    padding: var(--space-6) var(--space-12);
  }

  .slot-input {
    font-size: var(--font-size-sm);
  }

  .modal {
    margin: var(--space-16);
  }
}

/* Scrollbar Styling */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--color-background);
}

::-webkit-scrollbar-thumb {
  background: var(--color-border);
  border-radius: var(--radius-full);
}

::-webkit-scrollbar-thumb:hover {
  background: var(--color-text-secondary);
}
  </style>
</head>
<body>
  <!-- App Header -->
  <header class="app-header">
    <div class="header-content">
      <div class="header-left">
        <h1 class="app-title">Weekly Agenda</h1>
        <div class="current-datetime" id="currentDateTime"></div>
      </div>
      <div class="header-actions">
        <button class="btn-today" id="btnToday">üìÖ Today</button>
        <button class="btn-settings" id="btnSettings">‚öôÔ∏è Settings</button>
      </div>
    </div>
  </header>

  <!-- Day Tabs -->
  <nav class="day-tabs">
    <div class="day-tabs-container" id="dayTabs"></div>
  </nav>

  <!-- Main Content -->
  <main class="main-content">
    <div class="schedule-container">
      <div class="schedule-header">
        <h2 class="schedule-day-name" id="scheduleDayName"></h2>
      </div>
      <div class="schedule-grid" id="scheduleGrid"></div>
    </div>
  </main>

  <!-- Settings Modal -->
  <div class="modal-overlay" id="settingsModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Time Range Settings</h3>
        <button class="modal-close" id="modalClose">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label" for="startTime">Start Time</label>
          <select class="form-select" id="startTime"></select>
        </div>
        <div class="form-group">
          <label class="form-label" for="endTime">End Time</label>
          <select class="form-select" id="endTime"></select>
        </div>
        <div class="time-range-preview" id="timeRangePreview"></div>
        <div class="form-group">
          <label class="form-label" for="languageSelect">Language</label>
          <div class="language-selector" id="languageSelector"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="btnCancel">Cancel</button>
        <button class="btn btn-primary" id="btnSave">Save Changes</button>
      </div>
    </div>
  </div>

  <script>
    // Translations Object
    const translations = {
      en_US: {
        flag: "üá∫üá∏",
        name: "English (US)",
        weekdays: {
          Sunday: "Sunday", Monday: "Monday", Tuesday: "Tuesday", Wednesday: "Wednesday",
          Thursday: "Thursday", Friday: "Friday", Saturday: "Saturday",
          Sun: "Sun", Mon: "Mon", Tue: "Tue", Wed: "Wed", Thu: "Thu", Fri: "Fri", Sat: "Sat"
        },
        header: "Weekly Agenda",
        today: "Today",
        settings: "Settings",
        addItem: "Add agenda item...",
        modalTitle: "Time Configuration",
        startTime: "Start Time",
        endTime: "End Time",
        language: "Language",
        save: "Save",
        close: "Close",
        cancel: "Cancel",
        duration_1h: "(1h)",
        duration_1h30m: "(1.5h)",
        duration_2h: "(2h)",
        duration_2h30m: "(2.5h)",
        duration_3h: "(3h)",
        duration_3h30m: "(3.5h)",
        duration_4h: "(4h)",
        timeRangePreview: "Duration: {hours} hours ‚Ä¢ {slots} time slots",
        errorEndTime: "End time must be after start time",
        errorMinDuration: "Time range must be at least 2 hours"
      },
      pt_BR: {
        flag: "üáßüá∑",
        name: "Portuguese (BR)",
        weekdays: {
          Sunday: "Domingo", Monday: "Segunda", Tuesday: "Ter√ßa", Wednesday: "Quarta",
          Thursday: "Quinta", Friday: "Sexta", Saturday: "S√°bado",
          Sun: "Dom", Mon: "Seg", Tue: "Ter", Wed: "Qua", Thu: "Qui", Fri: "Sex", Sat: "Sab"
        },
        header: "Agenda Semanal",
        today: "Hoje",
        settings: "Configura√ß√µes",
        addItem: "Adicionar item...",
        modalTitle: "Configura√ß√£o de Hor√°rio",
        startTime: "Hora de In√≠cio",
        endTime: "Hora de T√©rmino",
        language: "Idioma",
        save: "Salvar",
        close: "Fechar",
        cancel: "Cancelar",
        duration_1h: "(1h)",
        duration_1h30m: "(1h30min)",
        duration_2h: "(2h)",
        duration_2h30m: "(2h30min)",
        duration_3h: "(3h)",
        duration_3h30m: "(3h30min)",
        duration_4h: "(4h)",
        timeRangePreview: "Dura√ß√£o: {hours} horas ‚Ä¢ {slots} intervalos",
        errorEndTime: "Hora de t√©rmino deve ser ap√≥s hora de in√≠cio",
        errorMinDuration: "Intervalo de tempo deve ser de pelo menos 2 horas"
      },
      es_ES: {
        flag: "üá™üá∏",
        name: "Spanish (Spain)",
        weekdays: {
          Sunday: "Domingo", Monday: "Lunes", Tuesday: "Martes", Wednesday: "Mi√©rcoles",
          Thursday: "Jueves", Friday: "Viernes", Saturday: "S√°bado",
          Sun: "Dom", Mon: "Lun", Tue: "Mar", Wed: "Mi√©", Thu: "Jue", Fri: "Vie", Sat: "Sab"
        },
        header: "Agenda Semanal",
        today: "Hoy",
        settings: "Configuraci√≥n",
        addItem: "Agregar elemento...",
        modalTitle: "Configuraci√≥n de Hora",
        startTime: "Hora de Inicio",
        endTime: "Hora de Fin",
        language: "Idioma",
        save: "Guardar",
        close: "Cerrar",
        cancel: "Cancelar",
        duration_1h: "(1h)",
        duration_1h30m: "(1h30m)",
        duration_2h: "(2h)",
        duration_2h30m: "(2h30m)",
        duration_3h: "(3h)",
        duration_3h30m: "(3h30m)",
        duration_4h: "(4h)",
        timeRangePreview: "Duraci√≥n: {hours} horas ‚Ä¢ {slots} intervalos",
        errorEndTime: "La hora de fin debe ser posterior a la hora de inicio",
        errorMinDuration: "El rango de tiempo debe ser de al menos 2 horas"
      },
      ja_JP: {
        flag: "üáØüáµ",
        name: "Êó•Êú¨Ë™û",
        weekdays: {
          Sunday: "Êó•ÊõúÊó•", Monday: "ÊúàÊõúÊó•", Tuesday: "ÁÅ´ÊõúÊó•", Wednesday: "Ê∞¥ÊõúÊó•",
          Thursday: "Êú®ÊõúÊó•", Friday: "ÈáëÊõúÊó•", Saturday: "ÂúüÊõúÊó•",
          Sun: "Êó•", Mon: "Êúà", Tue: "ÁÅ´", Wed: "Ê∞¥", Thu: "Êú®", Fri: "Èáë", Sat: "Âúü"
        },
        header: "ÈÄ±Èñì‰∫àÂÆö",
        today: "‰ªäÊó•",
        settings: "Ë®≠ÂÆö",
        addItem: "‰∫àÂÆö„ÇíËøΩÂä†...",
        modalTitle: "ÊôÇÈñìË®≠ÂÆö",
        startTime: "ÈñãÂßãÊôÇÂàª",
        endTime: "ÁµÇ‰∫ÜÊôÇÂàª",
        language: "Ë®ÄË™û",
        save: "‰øùÂ≠ò",
        close: "Èñâ„Åò„Çã",
        cancel: "„Ç≠„É£„É≥„Çª„É´",
        duration_1h: "(1ÊôÇÈñì)",
        duration_1h30m: "(1ÊôÇÈñì30ÂàÜ)",
        duration_2h: "(2ÊôÇÈñì)",
        duration_2h30m: "(2ÊôÇÈñì30ÂàÜ)",
        duration_3h: "(3ÊôÇÈñì)",
        duration_3h30m: "(3ÊôÇÈñì30ÂàÜ)",
        duration_4h: "(4ÊôÇÈñì)",
        timeRangePreview: "ÊúüÈñì: {hours}ÊôÇÈñì ‚Ä¢ {slots}„Çπ„É≠„ÉÉ„Éà",
        errorEndTime: "ÁµÇ‰∫ÜÊôÇÂàª„ÅØÈñãÂßãÊôÇÂàª„Çà„ÇäÂæå„Åß„Å™„Åë„Çå„Å∞„Å™„Çä„Åæ„Åõ„Çì",
        errorMinDuration: "ÊôÇÈñìÁØÑÂõ≤„ÅØÊúÄ‰Ωé2ÊôÇÈñìÂøÖË¶Å„Åß„Åô"
      }
    };

    // Application State (using in-memory variables instead of localStorage)
    let appState = {
      currentDay: new Date().getDay(),
      startTime: '06:00',
      endTime: '22:00',
      agendaData: {},
      checkboxStates: {},
      lastCheckedDate: new Date().toDateString(),
      currentLanguage: 'pt_BR'
    };

    // Translation helper function
    function t(key) {
      return translations[appState.currentLanguage][key] || key;
    }

    // Set language and update UI
    function setLanguage(langCode) {
      appState.currentLanguage = langCode;
      saveStateToStorage();
      updateAllTranslations();
    }

    // Update all UI translations
    function updateAllTranslations() {
      document.querySelector('.app-title').textContent = t('header');
      document.querySelector('.btn-today').innerHTML = `üìÖ ${t('today')}`;
      document.querySelector('.btn-settings').innerHTML = `‚öôÔ∏è ${t('settings')}`;
      document.querySelector('.modal-title').textContent = t('modalTitle');
      document.querySelector('label[for="startTime"]').textContent = t('startTime');
      document.querySelector('label[for="endTime"]').textContent = t('endTime');
      document.querySelector('label[for="languageSelect"]').textContent = t('language');
      document.getElementById('btnCancel').textContent = t('cancel');
      document.getElementById('btnSave').textContent = t('save');
      
      renderDayTabs();
      renderSchedule();
      updateTimeRangePreview();
    }

    // Get weekday names (language-aware)
    function getWeekdays() {
      const baseWeekdays = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
      const baseAbbr = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      
      return baseWeekdays.map((day, index) => ({
        name: t('weekdays')[day],
        abbr: t('weekdays')[baseAbbr[index]],
        index: index
      }));
    }

    // Initialize the app
    function init() {
      // Load state from localStorage first
      loadStateFromStorage();
      checkAndResetDailyCheckboxes();
      // Render UI with loaded data
      renderDayTabs();
      renderSchedule();
      updateDateTime();
      setupEventListeners();
      scrollToCurrentTime();
      
      // Update time every minute
      setInterval(updateDateTime, 60000);
      setInterval(checkAndUpdateCurrentTime, 60000);
    }

    // Persistent storage using URL hash as a workaround for localStorage restrictions
    function loadStateFromStorage() {
      try {
        // Try to load from URL hash (encoded state)
        const hash = window.location.hash.substring(1);
        if (hash) {
          const decoded = decodeURIComponent(hash);
          const parsedState = JSON.parse(atob(decoded));
          appState.currentDay = parsedState.currentDay || new Date().getDay();
          appState.startTime = parsedState.startTime || '06:00';
          appState.endTime = parsedState.endTime || '22:00';
          appState.agendaData = parsedState.agendaData || {};
          appState.checkboxStates = parsedState.checkboxStates || {};
          appState.lastCheckedDate = parsedState.lastCheckedDate || new Date().toDateString();
          appState.currentLanguage = parsedState.currentLanguage || 'pt_BR';
          console.log('State loaded from URL hash:', appState);
        }
      } catch (error) {
        console.error('Error loading from URL hash:', error);
      }
    }

    // Save state to URL hash for persistence
    function saveStateToStorage() {
      try {
        const stateJson = JSON.stringify(appState);
        const encoded = btoa(stateJson);
        window.location.hash = encodeURIComponent(encoded);
        console.log('State saved to URL hash');
      } catch (error) {
        console.error('Error saving to URL hash:', error);
      }
    }

    // Check if date changed and reset checkboxes
    function checkAndResetDailyCheckboxes() {
      const today = new Date().toDateString();
      if (appState.lastCheckedDate !== today) {
        appState.checkboxStates = {};
        appState.lastCheckedDate = today;
        saveStateToStorage();
      }
    }

    // Update date and time display
    function updateDateTime() {
      const now = new Date();
      const options = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      };
      document.getElementById('currentDateTime').textContent = now.toLocaleDateString('en-US', options);
    }

    // Render day tabs
    function renderDayTabs() {
      const container = document.getElementById('dayTabs');
      const today = new Date().getDay();
      const weekdays = getWeekdays();
      
      container.innerHTML = weekdays.map(day => `
        <button 
          class="day-tab ${day.index === appState.currentDay ? 'active' : ''} ${day.index === today ? 'today' : ''}"
          data-day="${day.index}"
        >
          ${day.name}
        </button>
      `).join('');

      // Add click listeners
      container.querySelectorAll('.day-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          appState.currentDay = parseInt(tab.dataset.day);
          renderDayTabs();
          renderSchedule();
        });
      });
    }

    // Generate time slots
    function generateTimeSlots() {
      const slots = [];
      const [startHour, startMin] = appState.startTime.split(':').map(Number);
      const [endHour, endMin] = appState.endTime.split(':').map(Number);
      
      let currentHour = startHour;
      let currentMin = startMin;
      
      while (currentHour < endHour || (currentHour === endHour && currentMin < endMin)) {
        const timeStr = `${String(currentHour).padStart(2, '0')}:${String(currentMin).padStart(2, '0')}`;
        slots.push(timeStr);
        
        currentMin += 30;
        if (currentMin >= 60) {
          currentMin = 0;
          currentHour++;
        }
      }
      
      return slots;
    }

    // Check if time slot is current
    function isCurrentTimeSlot(timeStr) {
      const now = new Date();
      const [slotHour, slotMin] = timeStr.split(':').map(Number);
      const currentHour = now.getHours();
      const currentMin = now.getMinutes();
      
      // Check if current time falls within this 30-minute slot
      if (currentHour === slotHour) {
        if (slotMin === 0 && currentMin < 30) return true;
        if (slotMin === 30 && currentMin >= 30) return true;
      }
      
      return false;
    }

    // Check if time slot is in the past
    function isPastTimeSlot(timeStr) {
      const now = new Date();
      const [slotHour, slotMin] = timeStr.split(':').map(Number);
      const currentHour = now.getHours();
      const currentMin = now.getMinutes();
      
      if (slotHour < currentHour) return true;
      if (slotHour === currentHour && slotMin < currentMin) return true;
      
      return false;
    }

    // Calculate merged slots (consecutive items with same text)
    function calculateMergedSlots(slots) {
      const mergedSlots = [];
      let i = 0;
      
      while (i < slots.length) {
        const timeStr = slots[i];
        const slotKey = `${appState.currentDay}-${timeStr}`;
        const agendaText = appState.agendaData[slotKey] || '';
        
        if (!agendaText.trim()) {
          // No text, just add as single slot
          mergedSlots.push({ startTime: timeStr, endTime: null, slotKeys: [slotKey], duration: 1 });
          i++;
          continue;
        }
        
        // Check for consecutive slots with same text
        let consecutiveCount = 1;
        let j = i + 1;
        const slotKeys = [slotKey];
        
        while (j < slots.length) {
          const nextSlotKey = `${appState.currentDay}-${slots[j]}`;
          const nextAgendaText = appState.agendaData[nextSlotKey] || '';
          
          if (nextAgendaText.trim() === agendaText.trim()) {
            consecutiveCount++;
            slotKeys.push(nextSlotKey);
            j++;
          } else {
            break;
          }
        }
        
        // Calculate end time
        let endTime = null;
        if (consecutiveCount > 1) {
          const [startHour, startMin] = timeStr.split(':').map(Number);
          let endHour = startHour;
          let endMin = startMin + (consecutiveCount * 30);
          
          while (endMin >= 60) {
            endMin -= 60;
            endHour++;
          }
          
          endTime = `${String(endHour).padStart(2, '0')}:${String(endMin).padStart(2, '0')}`;
        }
        
        mergedSlots.push({
          startTime: timeStr,
          endTime: endTime,
          slotKeys: slotKeys,
          duration: consecutiveCount
        });
        
        i = j;
      }
      
      return mergedSlots;
    }
    
    // Get duration text for merged slots - DISABLED per requirements
    function getDurationText(duration) {
      // Don't show duration text - visual height indicates duration
      return '';
    }

    // Merge slots on blur
    function mergeOnBlur(inputElement) {
      const slotKey = inputElement.dataset.slot;
      const [day, timeStr] = slotKey.split('-');
      const agendaText = appState.agendaData[slotKey] || '';
      
      if (!agendaText.trim()) {
        saveStateToStorage();
        renderSchedule();
        return;
      }
      
      // Find next consecutive slots with same text
      const slots = generateTimeSlots();
      const currentIndex = slots.indexOf(timeStr);
      
      if (currentIndex === -1) return;
      
      // Check subsequent slots for matching text
      for (let i = currentIndex + 1; i < slots.length; i++) {
        const nextSlotKey = `${day}-${slots[i]}`;
        const nextText = appState.agendaData[nextSlotKey] || '';
        
        if (nextText.trim() === agendaText.trim()) {
          // Continue checking
          continue;
        } else {
          // Different text, stop
          break;
        }
      }
      
      // Save merged state to localStorage
      saveStateToStorage();
      
      // Re-render to show merged state
      renderSchedule();
    }
    
    // Unmerge slots - FIXED
    function unmergeSlots(slotKeys, originalText) {
      console.log('Unmerging function called with:', slotKeys, originalText);
      
      if (!Array.isArray(slotKeys) || slotKeys.length === 0) return;
      
      // Keep text only in the first slot, clear the rest so they become independent
      const firstKey = slotKeys[0];
      appState.agendaData[firstKey] = originalText;
      
      for (let i = 1; i < slotKeys.length; i++) {
        const key = slotKeys[i];
        // Clear subsequent slots so they don't merge back
        if (appState.agendaData.hasOwnProperty(key)) {
          appState.agendaData[key] = '';
        } else {
          // ensure key exists as empty
          appState.agendaData[key] = '';
        }
        console.log('Cleared slot', key);
      }
      
      // Save immediately to storage/hash
      saveStateToStorage();
      
      // Re-render schedule
      renderSchedule();
      
      // Focus first input (slight delay to ensure DOM rendered)
      setTimeout(() => {
        const container = document.getElementById('scheduleGrid');
        const input = container.querySelector(`.slot-input[data-slot="${firstKey}"]`);
        if (input) {
          input.focus();
          // place caret at end
          const len = input.value.length;
          input.setSelectionRange(len, len);
        }
      }, 50);
      
      console.log('Unmerge complete, schedule re-rendered');
    }

    // Render schedule
    function renderSchedule() {
      const container = document.getElementById('scheduleGrid');
      const dayName = document.getElementById('scheduleDayName');
      const today = new Date().getDay();
      const isToday = appState.currentDay === today;
      const weekdays = getWeekdays();
      
      dayName.textContent = weekdays[appState.currentDay].name;
      
      const slots = generateTimeSlots();
      
      if (slots.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üìÖ</div>
            <div class="empty-state-text">Please configure your time range in settings</div>
          </div>
        `;
        return;
      }

      const mergedSlots = calculateMergedSlots(slots);
      
      container.innerHTML = mergedSlots.map(merged => {
        const firstSlotKey = merged.slotKeys[0];
        const agendaText = appState.agendaData[firstSlotKey] || '';
        const isChecked = appState.checkboxStates[firstSlotKey] || false;
        const isCurrent = isToday && isCurrentTimeSlot(merged.startTime);
        const isPast = isToday && isPastTimeSlot(merged.startTime);
        const durationText = getDurationText(merged.duration);
        const isMerged = merged.duration > 1;
        
        // Calculate height based on merged duration
        const slotHeight = merged.duration * 48; // 48px per slot
        
        return `
          <div class="time-slot ${isCurrent ? 'current-time' : ''} ${isPast ? 'past-slot' : ''}" 
               data-time="${merged.startTime}"
               style="${isMerged ? `min-height: ${slotHeight}px;` : ''}">
            <div class="time-label">${merged.startTime}${merged.endTime ? ` - ${merged.endTime}` : ''}</div>
            <div class="slot-content">
              <input 
                type="checkbox" 
                class="slot-checkbox"
                data-slot="${firstSlotKey}"
                ${isChecked ? 'checked' : ''}
                ${!isToday ? 'disabled' : ''}
              />
              <input 
                type="text" 
                class="slot-input ${isChecked ? 'checked' : ''}"
                data-slot="${firstSlotKey}"
                data-merged-slots='${JSON.stringify(merged.slotKeys)}'
                value="${agendaText}"
                placeholder="${t('addItem')}"
              />
              ${isMerged && agendaText.trim() ? `
                <button 
                  class="unmerge-btn"
                  data-slot-keys='${JSON.stringify(merged.slotKeys)}'
                  data-text="${agendaText.replace(/"/g, '&quot;')}"
                  data-action="unmerge"
                  type="button"
                  title="Unmerge"
                >
                  ‚úÇÔ∏è Unmerge
                </button>
              ` : ''}
            </div>
          </div>
        `;
      }).join('');

      // Add event listeners for inputs
      container.querySelectorAll('.slot-input').forEach(input => {
        input.addEventListener('input', (e) => {
          const slotKey = e.target.dataset.slot;
          const newValue = e.target.value;
          
          // Store the value directly without any suffix processing
          appState.agendaData[slotKey] = newValue;
          // Save to localStorage on every input change
          saveStateToStorage();
        });
        
        // Add blur event listener for merge checking
        input.addEventListener('blur', (e) => {
          mergeOnBlur(e.target);
          // Save to localStorage after merge
          saveStateToStorage();
        });
      });

      // Add event listeners for checkboxes
      container.querySelectorAll('.slot-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', (e) => {
          const slotKey = e.target.dataset.slot;
          appState.checkboxStates[slotKey] = e.target.checked;
          
          // Update the corresponding input style
          const input = container.querySelector(`.slot-input[data-slot="${slotKey}"]`);
          if (input) {
            if (e.target.checked) {
              input.classList.add('checked');
            } else {
              input.classList.remove('checked');
            }
          }
          
          // Save to localStorage on checkbox change
          saveStateToStorage();
        });
      });
      
      // Add event listeners for unmerge buttons using event delegation
      container.querySelectorAll('.unmerge-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          
          const button = e.currentTarget;
          console.log('Unmerge button clicked', button);
          
          try {
            const slotKeys = JSON.parse(button.getAttribute('data-slot-keys'));
            const originalText = button.getAttribute('data-text').replace(/&quot;/g, '"');
            
            console.log('Unmerging slots:', slotKeys, 'with text:', originalText);
            unmergeSlots(slotKeys, originalText);
          } catch (error) {
            console.error('Error unmerging slots:', error);
          }
        });
      });
    }

    // Check and update current time highlighting
    function checkAndUpdateCurrentTime() {
      const today = new Date().getDay();
      if (appState.currentDay === today) {
        renderSchedule();
      }
    }

    // Scroll to current time
    function scrollToCurrentTime() {
      const today = new Date().getDay();
      if (appState.currentDay === today) {
        setTimeout(() => {
          const currentSlot = document.querySelector('.time-slot.current-time');
          if (currentSlot) {
            currentSlot.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        }, 100);
      }
    }

    // Setup event listeners
    function setupEventListeners() {
      // Today button
      document.getElementById('btnToday').addEventListener('click', () => {
        appState.currentDay = new Date().getDay();
        saveStateToStorage();
        renderDayTabs();
        renderSchedule();
        scrollToCurrentTime();
      });

      // Settings button
      document.getElementById('btnSettings').addEventListener('click', openSettingsModal);

      // Modal close
      document.getElementById('modalClose').addEventListener('click', closeSettingsModal);
      document.getElementById('btnCancel').addEventListener('click', closeSettingsModal);

      // Modal overlay click
      document.getElementById('settingsModal').addEventListener('click', (e) => {
        if (e.target.id === 'settingsModal') {
          closeSettingsModal();
        }
      });

      // Save settings
      document.getElementById('btnSave').addEventListener('click', saveSettings);

      // Time range preview
      document.getElementById('startTime').addEventListener('change', updateTimeRangePreview);
      document.getElementById('endTime').addEventListener('change', updateTimeRangePreview);
    }

    // Render language selector
    function renderLanguageSelector() {
      const container = document.getElementById('languageSelector');
      const languages = ['en_US', 'pt_BR', 'es_ES', 'ja_JP'];
      
      container.innerHTML = languages.map(langCode => {
        const lang = translations[langCode];
        return `
          <button 
            class="language-option ${appState.currentLanguage === langCode ? 'active' : ''}"
            data-lang="${langCode}"
          >
            <span class="language-flag">${lang.flag}</span>
            <span class="language-name">${lang.name}</span>
          </button>
        `;
      }).join('');
      
      // Add click listeners
      container.querySelectorAll('.language-option').forEach(btn => {
        btn.addEventListener('click', () => {
          const langCode = btn.dataset.lang;
          setLanguage(langCode);
          renderLanguageSelector();
        });
      });
    }

    // Open settings modal
    function openSettingsModal() {
      populateTimeSelects();
      document.getElementById('startTime').value = appState.startTime;
      document.getElementById('endTime').value = appState.endTime;
      updateTimeRangePreview();
      renderLanguageSelector();
      document.getElementById('settingsModal').classList.add('active');
    }

    // Close settings modal
    function closeSettingsModal() {
      document.getElementById('settingsModal').classList.remove('active');
    }

    // Populate time select options
    function populateTimeSelects() {
      const startSelect = document.getElementById('startTime');
      const endSelect = document.getElementById('endTime');
      
      const times = [];
      for (let hour = 0; hour < 24; hour++) {
        for (let min = 0; min < 60; min += 30) {
          const timeStr = `${String(hour).padStart(2, '0')}:${String(min).padStart(2, '0')}`;
          times.push(timeStr);
        }
      }
      times.push('24:00'); // Add end of day
      
      startSelect.innerHTML = times.slice(0, -1).map(time => 
        `<option value="${time}">${time}</option>`
      ).join('');
      
      endSelect.innerHTML = times.map(time => 
        `<option value="${time}">${time}</option>`
      ).join('');
    }

    // Update time range preview
    function updateTimeRangePreview() {
      const startTime = document.getElementById('startTime').value;
      const endTime = document.getElementById('endTime').value;
      
      const [startHour] = startTime.split(':').map(Number);
      const [endHour, endMin] = endTime.split(':').map(Number);
      
      let totalMinutes = (endHour * 60 + endMin) - (startHour * 60);
      if (totalMinutes < 0) totalMinutes += 24 * 60;
      
      const hours = Math.floor(totalMinutes / 60);
      const slots = Math.floor(totalMinutes / 30);
      
      const previewText = t('timeRangePreview')
        .replace('{hours}', hours)
        .replace('{slots}', slots);
      
      document.getElementById('timeRangePreview').textContent = previewText;
    }

    // Save settings
    function saveSettings() {
      const startTime = document.getElementById('startTime').value;
      const endTime = document.getElementById('endTime').value;
      
      // Validation
      const [startHour, startMin] = startTime.split(':').map(Number);
      const [endHour, endMin] = endTime.split(':').map(Number);
      const startTotalMin = startHour * 60 + startMin;
      const endTotalMin = endHour * 60 + endMin;
      
      if (endTotalMin <= startTotalMin) {
        alert(t('errorEndTime'));
        return;
      }
      
      if (endTotalMin - startTotalMin < 120) {
        alert(t('errorMinDuration'));
        return;
      }
      
      appState.startTime = startTime;
      appState.endTime = endTime;
      saveStateToStorage();
      
      closeSettingsModal();
      renderSchedule();
    }

    // Initialize app when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>
